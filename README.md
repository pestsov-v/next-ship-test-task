# NextShip тестове завдання

Завдання в собі включає архітектурні рішення, а також реалізації безпосередніх тестових задач

## Зміст
- Зміст тестового завдання
- Архітектура застосунку
- Концепції
- Результати вирішення задач

## Зміст тестового завдання



## Архітектура застосунку


## Концепції


## Результати вирішення задач

### Завдання 1

- Ядро сервера має окремий єндпоїнт `/v1/streams` через, який необхідно завантажувати файли на сервер. 
  - З урахуванням конфігурації файл тимчасово зберігається в необхідному варіанта - в пам'яті, в тимчасову файлі і т.д.
  - Файл підтримує обробку декількох файлів.
  - Це необхідно для препроцессінга, в подальшому перевірки прав доступу, перевірки ліміту чи кількості запитів від тієї чи іншої сессії, обмеження в рамках конкретної сессії і т.д

![img_1.png](img_1.png)

- Після чого необхідно здійснити запит до `/v1/call/api/ShipNext/ShipAccounting/v1/set-employee-accounts` та передати унікальний ідентифікатор streamId - тимчасового файлу.

![img_2.png](img_2.png)

### Завдання 

Необхідно здійснити виклик маршруту `/v1/call/api/ShipNext/ShipEmployee/v1/calculate-employee-remuneration`. Результатом виконання є массив об'єктів:
```json5
{
  "status": "success",
  "data": {
    "remunerations": [
      {
        "totalDonationAmountAll": 28206.07878,
        "totalDonationAmount": 310.52318,
        "rewardPercentage": 0.011009087169542395,
        "totalDonationPool": 10000,
        "rewardAmount": 110.09087169542394,
        "employeeName": "Jensen",
        "employeeSurname": "Wuckert"
      },
      {
        "totalDonationAmountAll": 28206.07878,
        "totalDonationAmount": 242.88144,
        "rewardPercentage": 0.008610960846220823,
        "totalDonationPool": 10000,
        "rewardAmount": 86.10960846220823,
        "employeeName": "Dangelo",
        "employeeSurname": "Larkin"
      },
      {
        "totalDonationAmountAll": 28206.07878,
        "totalDonationAmount": 132.44,
        "rewardPercentage": 0.004695441753282943,
        "totalDonationPool": 10000,
        "rewardAmount": 46.95441753282943,
        "employeeName": "Dangelo",
        "employeeSurname": "Larkin"
      },
      {
        "totalDonationAmountAll": 28206.07878,
        "totalDonationAmount": 208.12,
        "rewardPercentage": 0.007378551326587482,
        "totalDonationPool": 10000,
        "rewardAmount": 73.78551326587481,
        "employeeName": "Dangelo",
        "employeeSurname": "Larkin"
      },
      // ...
    ]
  }
}
```
де:
- `totalDonationAmountAll` - суммарні пожертувавання співробітниками.
- `totalDonationAmount` - сума пожертувавнь конкретним співробітником.
- `rewardPercentage` - відсоток пожертувавнь конкретним працівником відносно `totalDonationAmountAll`
- `totalDonationPool` - загальний пул виногороди.
- `rewardAmount` - винагорода конкретного співпрацівника.
- `employeeName` - ім'я працівника.
- `employeeSurname` - прізвище працівника.


![img.png](img.png)

### Відповіді на запитання

1. Як змінити код для підтримки різних версій файлів?
    Ядро сервера не зміниться ніяк не зміниться. В Схемі застосунків в залежності від бізнес-вимог будуть наступні сценарії:
   - в системі в колекції "ShipAccounting" буде замінений обробник маршруту в документі Controller, в разі зміни структури бази даних, додатково пишеться міграція бази даних.
   - Створення нового маршруту з новою версією (ядро сервера вимагається вказувати версію маршруту), та в документі helpers відповідної категорії написаний метод `transform`, який переводить з старого формату (для підтримки версії v1 в новий формат).

2. Як зміниться система імпорту, якщо зникнуть дані про курси валют файл, і його потрібно буде отримати асинхронно (через API)?
    - В `helpers` колекції `ShipAccounting` потрібно створити додаткову перевірку при `Split` файлу по ключовому слову `Rates`. Якщо елемент один (за відсутності `Rates`) - необхідно викликати додатковий helper -  `getRatesForHTTP`, в якому відбувається асихнронний запит до відповідної інтеграції.
В подальшому, в залежності від бізнес-вимог, потрібно зберігати курс або в базі даних або в кеш сервісі, або здійснювати постійно запит до інтеграції - власника інформації.
3. В майбутньому клієнт може забажати імпортувати файли через веб-інтерфейс, як можна змінити систему, щоб це дозволило?
    - Ніяк, логіка побудова с самого початку таким чином, щоб файл завантажувався через API.

